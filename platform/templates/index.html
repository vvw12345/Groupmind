<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人工标注核验平台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- 顶部导航栏 -->
    <header class="app-header">
        <div class="header-content">
            <div class="header-brand">
                <i class="fas fa-clipboard-check"></i>
                <span>人工标注核验平台</span>
            </div>
            
            <!-- 数据集信息标签 -->
            <div id="datasetTags" class="dataset-tags" style="display: none;">
                <span id="relabelModeTag" class="dataset-tag relabel-mode-tag" style="display: none;">
                    <i class="fas fa-redo-alt"></i>
                    重标注模式
                </span>
                <span class="dataset-tag">
                    <i class="fas fa-database"></i>
                    <span id="headerTotalSamples">0</span> 样本
                </span>
                <span class="dataset-tag">
                    <i class="fas fa-chart-line"></i>
                    进度: <span id="headerProgress">0/0</span>
                </span>
                <span class="dataset-tag">
                    <i class="fas fa-robot"></i>
                    <span id="headerModel">-</span>
                </span>
                <span id="relabeledCountTag" class="dataset-tag" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    已标注: <span id="headerRelabeledCount">0</span>
                </span>
            </div>
            
            <!-- 文件选择工具栏 -->
            <div class="header-toolbar">
                <select id="fileSelect" class="file-select">
                    <option value="">选择数据文件...</option>
                </select>
                <button id="loadBtn" class="btn-load">
                    <i class="fas fa-folder-open"></i>
                    <span class="btn-text">加载</span>
                </button>
                <div class="toolbar-divider"></div>
                <button id="relabelModeBtn" class="btn-relabel-mode">
                    <i class="fas fa-redo-alt"></i>
                    <span class="btn-text">重标注模式</span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 - 三栏布局 -->
    <div class="app-container">
        <div class="app-layout three-column">
            
            <!-- 左侧栏：情报侧边栏 -->
            <aside id="infoSidebar" class="info-sidebar" style="display: none;">
                <div class="sidebar-header">
                    <i class="fas fa-theater-masks"></i>
                    <strong>情境情报</strong>
                    <div class="sidebar-badges">
                        <span class="badge bg-primary" id="benchmarkIdBadge"></span>
                        <span class="badge bg-secondary" id="metaThemeBadge"></span>
                    </div>
                </div>
                <div class="sidebar-content">
                    <div class="sidebar-section">
                        <h6 class="sidebar-label">场景描述</h6>
                        <p id="scenarioDescription" class="scenario-text"></p>
                    </div>
                    <div class="sidebar-section">
                        <h6 class="sidebar-label">角色情报</h6>
                        <div id="personas" class="personas-list"></div>
                    </div>
                </div>
            </aside>

            <!-- 中间栏：沉浸式对话区 -->
            <main id="dialogueCard" class="dialogue-main" style="display: none;">
                <div class="dialogue-main-header">
                    <div class="dialogue-info">
                        <span class="badge bg-info">
                            <i class="fas fa-comments"></i>
                            <span id="dialogueTurns">0</span> 轮
                        </span>
                        <span class="badge bg-danger ms-2">
                            <i class="fas fa-exclamation-circle"></i>
                            Turn <span id="criticalMoment">-</span>
                        </span>
                    </div>
                </div>
                <div class="dialogue-main-content" id="dialogueContent"></div>
            </main>

            <!-- 右侧栏：标注任务区 -->
            <aside class="task-sidebar">
                <div id="labelsCard" class="labels-card" style="display: none;">
                    <div class="card-header">
                        <i class="fas fa-tags"></i>
                        <span>评测任务</span>
                    </div>
                    <div class="card-body">
                        <!-- Nav Tabs -->
                        <ul class="nav nav-tabs task-tabs" id="taskTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="atmosphere-tab" data-bs-toggle="tab" data-bs-target="#atmosphere-pane" type="button" role="tab" aria-controls="atmosphere-pane" aria-selected="true">
                                    <i class="fas fa-heart"></i>
                                    <span>氛围识别</span>
                                    <span class="task-status" id="atmosphereStatus"></span>
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="ky-tab" data-bs-toggle="tab" data-bs-target="#ky-pane" type="button" role="tab" aria-controls="ky-pane" aria-selected="false">
                                    <i class="fas fa-brain"></i>
                                    <span>KY测试</span>
                                    <span class="task-status" id="kyStatus"></span>
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="intent-tab" data-bs-toggle="tab" data-bs-target="#intent-pane" type="button" role="tab" aria-controls="intent-pane" aria-selected="false">
                                    <i class="fas fa-search"></i>
                                    <span>意图推断</span>
                                    <span class="task-status" id="intentStatus"></span>
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="taskTabContent">
                            <!-- 氛围识别 -->
                            <div class="tab-pane fade show active" id="atmosphere-pane" role="tabpanel" aria-labelledby="atmosphere-tab">
                                <div class="task-container">
                                    <p id="atmosphereQuestion" class="question-text"></p>
                                    <div id="atmosphereOptions" class="options-container"></div>
                                    <button class="btn-next-task" id="atmosphereNext" style="display: none;">
                                        下一题 <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- KY测试 -->
                            <div class="tab-pane fade" id="ky-pane" role="tabpanel" aria-labelledby="ky-tab">
                                <div class="task-container">
                                    <p id="kyQuestion" class="question-text"></p>
                                    <div id="kyOptions" class="options-container"></div>
                                    <button class="btn-next-task" id="kyNext" style="display: none;">
                                        下一题 <i class="fas fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- 意图推断 -->
                            <div class="tab-pane fade" id="intent-pane" role="tabpanel" aria-labelledby="intent-tab">
                                <div class="task-container">
                                    <p id="intentQuestion" class="question-text"></p>
                                    <div id="intentOptions" class="options-container"></div>
                                    <div class="task-complete-hint" id="intentComplete" style="display: none;">
                                        <i class="fas fa-check-circle"></i>
                                        <span>所有任务已完成，请点击底部保存按钮</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 对比信息 -->
                        <div id="comparisonInfo" style="display: none;">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-balance-scale"></i> 答案对比</h6>
                                <div id="comparisonDetails"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- 底部悬浮导航栏 -->
    <div id="bottomBar" class="bottom-bar" style="display: none;">
        <div class="bottom-bar-content">
            <!-- 左侧：导航按钮 -->
            <div class="bottom-nav-group">
                <button id="prevBtn" class="btn-nav btn-nav-outline">
                    <i class="fas fa-chevron-left"></i>
                    <span>上一个</span>
                </button>
                <button id="nextBtn" class="btn-nav btn-nav-outline">
                    <span>下一个</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- 中间：跳转 -->
            <div class="bottom-goto-group">
                <label class="goto-label">跳转:</label>
                <input id="gotoInput" type="number" class="goto-input" min="1" placeholder="#">
                <button id="gotoBtn" class="btn-goto">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <!-- 右侧：保存按钮 -->
            <div class="bottom-save-group">
                <button id="saveBtn" class="btn-save">
                    <i class="fas fa-save"></i>
                    <span>保存标注</span>
                </button>
                <button id="saveNextBtn" class="btn-save-next">
                    <i class="fas fa-save"></i>
                    <span>保存并下一个</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 加载提示 -->
    <div id="loadingModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">正在加载数据...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
